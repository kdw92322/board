<!DOCTYPE html>
<html lang="en" 
	  xmlns:th="http://www.thymeleaf.org" 
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	  layout:decorate="~{layout/layout}">
<th:block layout:fragment="content">
<head>
	<meta charset="UTF-8">
	<title>파일관리</title>
</head>
<body>
	<div class="container-fluid">
		<div class="row" style="margin-top : 10px; margin-bottom : 10px;">
	    	<div class="col" style="margin-top:10px;">				
	    		<h4 style="font-weight: bold;"><i class="fa-regular fa-file"></i>&nbsp;파일관리</h4>
	    	</div>
	    	<div class="col" align="right" style="display:inline-block; margin-top:10px;">
	    		<button class="btn btn-primary" type="button" style="float:right; margin:5px;" th:onclick="upload()">파일 Upload(Common)</button>
	    		<button class="btn btn-info" type="button" style="float:right; margin:5px;" th:onclick="selectFileList();">조회</button>
	    	</div>
	    </div>
		<div class="row" style="border: groove; border-radius: 10px; padding:10px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);">
			<div class="col-12">
				<span style="font-weight: bold;"><i class="fa-solid fa-list"></i>&nbsp;목록</span>
			</div>
			<div class="col-12" style="text-align:center; max-height:70vh; margin-top:10px; overflow-y: auto; overflow-x: auto;">
				<div class="table-responsive" id="divFileList">
					<!-- FileList html bind -->
				</div>
			</div>
		</div>
	</div>
	
	<th:block th:replace="/fragments/_modals :: modal('fileUploadModal')">modal</th:block>
</body>
<script type="text/javascript">
$(function(){
	selectFileList();
});

var upload = function(){
	openModalPop("#fileUploadModal", "/modals/uploadView", {});
}

var selectFileList = function(){
	serviceParam.type = "GET";
	serviceParam.url = "/file/fileList";
	serviceParam.async = false;
	serviceParam.dataType = "text";
	serviceParam.data = {};
	serviceParam.isReturnValue = true;
	serviceParam.timeout = 0;
	serviceParam.isLoadingBar = false;
	var result = callService(serviceParam);
	$("#divFileList").html(result.value);
}

var deleteFile = function(uuid){
	if(confirm("이 파일을 삭제하시겠습니까?")){
		serviceParam.type = "DELETE";
		serviceParam.url = "/file/delete";
		serviceParam.async = false;
		serviceParam.dataType = "json";
		serviceParam.data = JSON.stringify({"uuid" : uuid});
		serviceParam.isReturnValue = true;
		serviceParam.timeout = 0;
		serviceParam.isLoadingBar = true;
		
		var result = callService(serviceParam);
		if(result.Status == "success"){
			swAlert(result.Status, "해당 파일이 삭제 되었습니다.", "S", "OK");
			setTimeout(function(){
				selectFileList();
				swal.close();
				$("#btn_close").click();
			}, 1000);
		}else{
			swAlert(result.Status, "서비스 실행 중 에러가 발생하였습니다.", "E", "OK");
			return;
		}
		
	}
}

</script>
</th:block>
</html>