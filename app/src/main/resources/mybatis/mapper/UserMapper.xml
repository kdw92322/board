<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.web.app.user.UserMapper">
	<select id="selectUserList" resultType="map">
		select user_id   as userId
			  ,username  as username	
			  ,email     as email
			  ,date_format(str_to_date(birth,'%Y%m%d'), '%Y-%m-%d') as birth
			  ,phone     as phone
			  ,join_date as joinDate
			  ,upt_dt    as uptDt
		  from user_info
		 where 1=1
		 <if test="id != '' and id != null">
		   and user_id = #{id}
		 </if> 
	</select>
	
	<select id="selectUserInfo" resultType="com.web.app.user.UserForm">
		select user_id                       as userId
			  ,username                      as username	
			  ,SUBSTRING_INDEX(email,'@',1)  as emailId
              ,concat('@', SUBSTRING_INDEX(email,'@',-1)) as emailAddr
              ,concat('@', SUBSTRING_INDEX(email,'@',-1)) as txtEmailAddr
			  ,SUBSTR(birth,1,4)             as year
              ,SUBSTR(birth,5,2)             as month
              ,SUBSTR(birth,7,2)             as day
              ,SUBSTR(phone,1,3)             as serial
              ,SUBSTR(phone,4,4)             as phoneNum1
              ,SUBSTR(phone,8,4)             as phoneNum2
			  ,join_date                     as joinDate
			  ,user_role                     as userRole
			  ,upt_dt                        as uptDt
			  ,convert(ifnull(DATEDIFF(sysdate(), upt_dt), 0), char) as lastupdatediff
		  from user_info
		 where 1=1
		 <if test="userId != '' and userId != null">
		   and user_id = #{userId}
		 </if>   	
	</select>	   
	
	
	<update id="updateUserList" parameterType="map">
		update user_info
		   set title = #{title}
			  ,content = #{content}
           	  ,writer = #{writer}
           	  ,user_role = #{userRole}
           	  ,upt_dt = sysdate()
		 where user_id = #{id}   
	</update>
	
	<delete id="deleteUserList" parameterType="map">
		delete 
		  from user_info
		 where user_id = #{id}   
	</delete>
</mapper>